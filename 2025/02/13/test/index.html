<!DOCTYPE html><html lang="zh-tw" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>EEG Undergraduate Research | 烏鴉囈語</title><meta name="robots" content="noindex"><meta name="author" content="烏鴉先生"><meta name="copyright" content="烏鴉先生"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="EEG_Undergraduat_Research專題_EEG  0321: Stage 1Outline透過pylsl抓取EEG訊號在preprocess過後透過unsupervised learning algorithm自動判別 alpha power在睜眼與閉眼之間的threshold DatasetSubject: 2EEG recording length: 30s, 0~10: Ey">
<meta property="og:type" content="article">
<meta property="og:title" content="EEG Undergraduate Research">
<meta property="og:url" content="http://withoutdirection.github.io/2025/02/13/test/index.html">
<meta property="og:site_name" content="烏鴉囈語">
<meta property="og:description" content="EEG_Undergraduat_Research專題_EEG  0321: Stage 1Outline透過pylsl抓取EEG訊號在preprocess過後透過unsupervised learning algorithm自動判別 alpha power在睜眼與閉眼之間的threshold DatasetSubject: 2EEG recording length: 30s, 0~10: Ey">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="http://withoutdirection.github.io/img/crow.webp">
<meta property="article:published_time" content="2025-02-13T11:58:02.474Z">
<meta property="article:modified_time" content="2025-04-17T10:07:41.632Z">
<meta property="article:author" content="烏鴉先生">
<meta property="article:tag" content="訊號處理">
<meta property="article:tag" content="BCI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://withoutdirection.github.io/img/crow.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "EEG Undergraduate Research",
  "url": "http://withoutdirection.github.io/2025/02/13/test/",
  "image": "http://withoutdirection.github.io/img/crow.webp",
  "datePublished": "2025-02-13T11:58:02.474Z",
  "dateModified": "2025-04-17T10:07:41.632Z",
  "author": [
    {
      "@type": "Person",
      "name": "烏鴉先生",
      "url": "https://withoutdirection.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://withoutdirection.github.io/2025/02/13/test/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const hour = new Date().getHours()
          const isNight = hour <= 6 || hour >= 17
          if (theme === undefined) isNight ? activateDarkMode() : activateLightMode()
          else theme === 'light' ? activateLightMode() : activateDarkMode()
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'EEG Undergraduate Research',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/modify.css"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="烏鴉囈語" type="application/atom+xml">
</head><body><div id="web_bg" style="background-image: url(img/forest.webp);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/crow.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 檔案</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 標籤</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> about</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/logo.webp" alt="Logo"><span class="site-name">烏鴉囈語</span></a><a class="nav-page-title" href="/"><span class="site-name">EEG Undergraduate Research</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 檔案</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 標籤</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> about</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div class="top-img" style="background-image: url(undefined);"></div><div id="post-info"><h1 class="post-title">EEG Undergraduate Research</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-02-13T11:58:02.474Z" title="Created 2025-02-13 19:58:02">2025-02-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-04-17T10:07:41.632Z" title="Updated 2025-04-17 18:07:41">2025-04-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><h1 id="EEG-Undergraduat-Research"><a href="#EEG-Undergraduat-Research" class="headerlink" title="EEG_Undergraduat_Research"></a>EEG_Undergraduat_Research</h1><p>專題_EEG</p>
<hr>
<h2 id="0321-Stage-1"><a href="#0321-Stage-1" class="headerlink" title="0321: Stage 1"></a>0321: Stage 1</h2><h3 id="Outline"><a href="#Outline" class="headerlink" title="Outline"></a>Outline</h3><p>透過pylsl抓取EEG訊號在preprocess過後透過unsupervised learning algorithm自動判別 alpha power在睜眼與閉眼之間的threshold</p>
<h3 id="Dataset"><a href="#Dataset" class="headerlink" title="Dataset"></a>Dataset</h3><p>Subject: 2<br>EEG recording length: 30s, 0~10: Eyes closed; 10~20: Eyes opened; 20~30: Eyes closed</p>
<h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h3><p>Data preprocess: ???<br>To consider time-domain features, unsupervised: ???</p>
<h3 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h3><hr>
<h2 id="0328-Preprocess"><a href="#0328-Preprocess" class="headerlink" title="0328: Preprocess"></a>0328: Preprocess</h2><p><a target="_blank" rel="noopener" href="https://github.com/cemeteryparty/real_time_LSL_BCI.git">LAB resource</a></p>
<h3 id="load-data"><a href="#load-data" class="headerlink" title="load data"></a>load data</h3><p>“””</p>
<pre><code>print("looking for an EEG stream...")
streamList = pylsl.resolve_streams()
streamList = [StreamInfo_(s) for s in streamList]
tb = pt.PrettyTable()
tb.field_names = ["sid", "name", "type", "#_channel", "srate", "srcID"]
for sid, stm in enumerate(streamList):
    sinfo = [sid, stm.name, stm.type, stm.n_chan, stm.srate, stm.ssid]
    tb.add_row(sinfo)
    # print(stm)
print(tb)
streamID = int(input("Select steam... "))
selcStream = streamList[streamID]
</code></pre>
<p>“””</p>
<ol>
<li>利用lsl讀取EEG裝置(Cyguns)透過udp 傳出之訊號</li>
<li>解析並透過prettytable 將裝置與 EEG資訊以表格形式呈現，類似:<table>
<thead>
<tr>
<th align="center">sid</th>
<th align="center">name</th>
<th align="center">type</th>
<th align="center">#_channel</th>
<th align="center">srate</th>
<th align="center">srcID</th>
</tr>
</thead>
<tbody><tr>
<td align="center">拿來幫助選要用</td>
<td align="center">裝置實體名稱</td>
<td align="center">訊號類型</td>
<td align="center">頻道數量</td>
<td align="center">取樣率</td>
<td align="center"><strong>我不知道</strong></td>
</tr>
<tr>
<td align="center">哪個裝置當data src</td>
<td align="center">E.g. Cygnus-xxx</td>
<td align="center">E.g. EEG</td>
<td align="center">E.g. 32</td>
<td align="center">E.g. 1000.0</td>
<td align="center">???</td>
</tr>
</tbody></table>
</li>
<li>選裝置做為要拿去進入整個model的data source</li>
</ol>
<h3 id="construct-object-for-data"><a href="#construct-object-for-data" class="headerlink" title="construct object for data"></a>construct object for data</h3><p><code>root = BasicRecv(stm.n_chan, selcStream.srate)</code></p>
<pre><code>*Basic Recdiver 為 SigIntercept之子類別*
</code></pre>
<ul>
<li><p>Bacic Recdiver<br>-&gt; input:   number of channels = n_channel/ sampling rate = sfreq<br>-&gt; 利用 input 與 buffer_size透過 <strong>SigIntercept</strong> 初始化Receiver<br>-&gt; buffer_size 為提供則設定為 sampling rate 之30倍 <del>主程式run.py裡根本沒有讓人發現這個input的可能lol</del>  </p>
</li>
<li><p>SigIntercept(這個好重要我看好久)</p>
</li>
</ul>
<ol>
<li><p>內容物(屬性)</p>
<ul>
<li>buffer: 拿來存資料的 <em>shape = (n_chan * n_timestamps)</em></li>
<li>time stamps: 紀錄時間資訊 <em>shape = (1 * n_timestamps)</em></li>
<li>flag: 拿來標記特定時間是啥的 <em>shape = (? * n_timestamps)</em></li>
<li>sampling rate: 取樣率</li>
<li>raiseStream: 拿來將處理好/ 未處裡的資料送出去的 … 嗎?</li>
<li>parent: <del>???</del></li>
<li>nextFID: 下一位來賓是誰</li>
</ul>
</li>
<li><p>function(方法)</p>
<ul>
<li>update:<ol>
<li><p>先抓x(input) 有多長</p>
</li>
<li><p>將原本buffer整筆資料往左推直到後面有x_len的空間<br> “””</p>
<pre><code> xLen = x.shape[1]
 self.buffer[:, :self.bufShape[1] - xLen] = self.buffer[:, xLen:]
 self.buffer[:, -xLen:] = x
</code></pre>
<p> “””</p>
</li>
<li><p>更新buffer新的資料時間並打上flag: nextFID， 原本往左推的tstmps/ flags也往左推</p>
</li>
<li><p>更新nextFID</p>
<p> “””</p>
<pre><code> self.tstmps += (x.shape[1] / self.sfreq)
 self.flags[:self.bufShape[1] - xLen] = self.flags[xLen:]
 self.flags[-xLen:] = self.nextFID
 self.nextFID += 1
</code></pre>
<p> “””</p>
</li>
</ol>
</li>
<li>step: 交由<em>parent</em>更新</li>
<li>send: 發送訊號 <del>沒看很懂</del></li>
</ul>
</li>
</ol>
<h3 id="preprocess"><a href="#preprocess" class="headerlink" title="preprocess"></a>preprocess</h3><p><code>block1 = PreProcessing(2, 40, selcStream.srate, 128.0, parent=root) # 1, 40</code></p>
<pre><code>-&gt; Preprocessing(目標最低頻, 目標最高頻, 輸入取樣率, 輸出取樣率, parent)
</code></pre>
<ul>
<li>PreProcessing<br>-&gt; 透過<strong>SigIntercept</strong> 建立處裡完的訊號物件<br>-&gt; 透過自定義的filter 濾掉訊號 <del>我看不懂filter</del><br>-&gt; 透過step更新buffer並分段處理input</li>
</ul>
<p>~~待續</p>
<hr>
<h2 id="0404-Preprocess"><a href="#0404-Preprocess" class="headerlink" title="0404: Preprocess"></a>0404: Preprocess</h2><h3 id="preprocess-in-custom-py"><a href="#preprocess-in-custom-py" class="headerlink" title="preprocess(in custom.py)"></a>preprocess(in custom.py)</h3><ol>
<li><p>initialize the object<br> 父類別為 <strong>SigIntercept</strong> </p>
 <figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, l_freq, h_freq, sfreq_IS, sfreq_OS, parent</span>):</span><br><span class="line">    duration = <span class="number">30.0</span></span><br><span class="line">    n_chan = parent.bufShape[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">super</span>(PreProcessing, <span class="variable language_">self</span>).__init__(</span><br><span class="line">        (n_chan, math.ceil(duration * sfreq_OS)),</span><br><span class="line">        raiseStream=<span class="literal">False</span>, name=<span class="string">"hidden_1"</span>, sfreq=sfreq_OS, parent=parent</span><br><span class="line">    )</span><br><span class="line">    <span class="variable language_">self</span>.sfreq_IS, <span class="variable language_">self</span>.sfreq_OS = sfreq_IS, sfreq_OS</span><br><span class="line">    <span class="variable language_">self</span>.filt = _create_filter(l_freq, h_freq, fs=<span class="variable language_">self</span>.sfreq_IS)</span><br><span class="line">    <span class="comment">#self.b_notch, self.a_notch = signal.iirnotch(w0=50.0, Q=20.0, fs=fsIn)  #Lab60, BCIERN50</span></span><br><span class="line">    <span class="variable language_">self</span>.x_part = np.zeros((<span class="variable language_">self</span>.bufShape[<span class="number">0</span>], <span class="number">0</span>), dtype=np.float32)</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><p>the concept of filter(濾波器)<br><strong>Finite Impulse Response</strong><br>[前情提要: DSP是啥- 未完成]<br>Finite: 濾波器對於訊號的反應時間是有限的，代表脈衝響應(Impluse response)有明確的開始和結束<br>Impluse: 持續時間極短但具有有限能量的信號。<br>Response: 濾波器的響應指的是當它受到輸入信號時的輸出。對於FIR濾波器來說，響應是通過將輸入信號與濾波器的有限脈衝響應進行卷積來確定的。這個卷積運算描述了濾波器如何修改輸入信號以產生所需的輸出信號。<br><img src="/2025/02/13/test/fir_def.png" alt="FIR def"><br><img src="/2025/02/13/test/fir_funct.png" alt="FIR funct"><br>訊號在FIT濾波器下變化的模式 -&gt;<br>假設有一訊號，為如下圖形：<br><img src="/2025/02/13/test/image.png" alt="signal"><br>傅立葉轉換後圖型如下，在此希望將其高頻部份濾除，只保留低頻部份：(黑細線為原本訊號的傅立葉轉換，紅粗線為希望保留與濾除的頻率分界)<br><img src="/2025/02/13/test/image-2.png" alt="after FFT"><br>因此，在傅立葉空間定義出上述紅線的函數，並將此函數與原本訊號的傅立葉轉換相乘：<br><img src="/2025/02/13/test/image-1.png" alt="after filter"><br>再做傅立葉逆轉換，就可得到濾除高頻部份的圖型 ：<br><img src="/2025/02/13/test/image-3.png" alt="Inverse-FFT"></p>
</li>
<li><p>code implement</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_create_filter</span>(<span class="params">l_freq, h_freq, fs, l_trans_bw=<span class="number">1</span>, h_trans_bw=<span class="number">1</span>, window=<span class="string">"hamming"</span>, phase=<span class="string">"causal"</span></span>):</span><br><span class="line"><span class="comment"># https://github.com/mne-tools/mne-python/blob/maint/1.5/mne/filter.py#L1126</span></span><br><span class="line"><span class="comment"># https://github.com/mne-tools/mne-python/blob/maint/1.5/mne/filter.py#L473</span></span><br><span class="line"></span><br><span class="line"><span class="string">""" filter_order """</span></span><br><span class="line">N = _length_factors[<span class="string">"hamming"</span>] / (<span class="number">1</span> / fs)</span><br><span class="line">N = math.ceil(N / <span class="number">2</span>) * <span class="number">2</span> + <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> phase == <span class="string">"causal"</span>:</span><br><span class="line">    N = N * <span class="number">2</span> - <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="string">""" construct transition gain """</span></span><br><span class="line">freq = [l_freq - l_trans_bw, l_freq, h_freq, h_freq + h_trans_bw]</span><br><span class="line">gain = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line"><span class="keyword">if</span> freq[-<span class="number">1</span>] != fs / <span class="number">2.0</span>:</span><br><span class="line">    freq += [fs / <span class="number">2.0</span>]</span><br><span class="line">    gain += [<span class="number">0</span>]</span><br><span class="line"><span class="keyword">if</span> freq[<span class="number">0</span>] != <span class="number">0</span>:</span><br><span class="line">    freq = [<span class="number">0</span>] + freq</span><br><span class="line">    gain = [<span class="number">0</span>] + gain</span><br><span class="line">freq = np.array(freq) / (fs / <span class="number">2.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">""" construct filter response """</span></span><br><span class="line">h = np.zeros(N, dtype=np.float32)</span><br><span class="line">prev_freq, prev_gain = freq[-<span class="number">1</span>], gain[-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> this_freq, this_gain <span class="keyword">in</span> <span class="built_in">zip</span>(freq[::-<span class="number">1</span>][<span class="number">1</span>:], gain[::-<span class="number">1</span>][<span class="number">1</span>:]):</span><br><span class="line">    <span class="keyword">if</span> this_gain != prev_gain:</span><br><span class="line">        transition = (prev_freq - this_freq) / <span class="number">2.0</span></span><br><span class="line">        this_N = <span class="built_in">int</span>(<span class="built_in">round</span>(_length_factors[window] / transition))</span><br><span class="line">        this_N += <span class="number">1</span> - this_N % <span class="number">2</span>  <span class="comment"># make it odd</span></span><br><span class="line"></span><br><span class="line">        this_h = firwin(</span><br><span class="line">            this_N,</span><br><span class="line">            (prev_freq + this_freq) / <span class="number">2.0</span>,</span><br><span class="line">            window=window,</span><br><span class="line">            pass_zero=<span class="literal">True</span>,</span><br><span class="line">            fs=freq[-<span class="number">1</span>] * <span class="number">2</span>,</span><br><span class="line">        )</span><br><span class="line">        offset = (N - this_N) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> this_gain == <span class="number">0</span>:</span><br><span class="line">            h[offset : N - offset] -= this_h</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            h[offset : N - offset] += this_h</span><br><span class="line">    prev_gain = this_gain</span><br><span class="line">    prev_freq = this_freq</span><br><span class="line"><span class="keyword">if</span> phase == <span class="string">"causal"</span>:</span><br><span class="line">    h = minimum_phase(h)</span><br><span class="line"><span class="keyword">return</span> h</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<ol>
<li>輸入參數: (低通頻率（l_freq）、高通頻率（h_freq）、採樣率（fs）、過渡帶寬度（l_trans_bw和h_trans_bw）、窗口類型（window）、相位類型（phase）)</li>
<li>決定濾波器長度(根據window 類型與 取樣率) </li>
<li>transition gain(過度增益):<del>這邊好難</del> 用來確保在低通濾波器和高通濾波器之間平滑過渡，使頻率響應在過渡區域內盡可能平滑，從而減少濾波器的振蕩或不穩定行為。</li>
<li>建構濾波器響應: 對 freq 和 gain 進行反向迭代，對於每一對頻率和增益，如果它們的增益不同，則計算兩者之間的過渡帶寬度，並根據這個過渡帶寬度來計算一個對應的濾波器響應。最終，將這些部分濾波器響應組合起來，得到最終的濾波器響應。 (如果phase是casule則將通過最小相位函數（minimum_phase）來確保濾波器是causal的。)</li>
</ol>
<p><code>一個因果濾波器是指濾波器的輸出僅依賴於當前和過去的輸入值，而不依賴未來的輸入值。換句話說，濾波器的輸出只取決於當前時間及之前的輸入，不受未來輸入的影響。</code></p>
</li>
</ul>
</li>
<li><p>process the signal by step</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">step</span>(<span class="params">self</span>):</span><br><span class="line">     filt = <span class="variable language_">self</span>.filt</span><br><span class="line">     buffer = <span class="variable language_">self</span>.parent.buffer</span><br><span class="line">     n_chan = buffer.shape[<span class="number">0</span>]</span><br><span class="line">     offset_beg = np.searchsorted(<span class="variable language_">self</span>.parent.flags, <span class="variable language_">self</span>.nextFID, side=<span class="string">"left"</span>)</span><br><span class="line">     xLen = buffer.shape[<span class="number">1</span>] - offset_beg</span><br><span class="line"></span><br><span class="line">     <span class="variable language_">self</span>.x_part = np.append(<span class="variable language_">self</span>.x_part, buffer[:, -xLen:], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">     <span class="string">""" band pass filtering """</span></span><br><span class="line">     xf_part = np.zeros(</span><br><span class="line">         (n_chan, <span class="variable language_">self</span>.x_part.shape[<span class="number">1</span>] - <span class="built_in">len</span>(filt) + <span class="number">1</span>), dtype=np.float32)</span><br><span class="line">     <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(n_chan):</span><br><span class="line">         xf_part[c] = oaconvolve(<span class="variable language_">self</span>.x_part[c], filt, mode=<span class="string">"valid"</span>)</span><br><span class="line">     <span class="comment"># zero-padding: edge effect, leave out of valid to next iteration</span></span><br><span class="line">     <span class="variable language_">self</span>.x_part = <span class="variable language_">self</span>.x_part[:, -(<span class="built_in">len</span>(filt) - <span class="number">1</span>):]</span><br><span class="line"></span><br><span class="line">     <span class="string">""" average rereference """</span></span><br><span class="line">     <span class="comment">##xf_part -= xf_part.mean(axis=0)</span></span><br><span class="line"></span><br><span class="line">     <span class="string">""" resample """</span></span><br><span class="line">     t_bef = np.linspace(<span class="number">0</span>, xf_part.shape[<span class="number">1</span>] / <span class="variable language_">self</span>.sfreq_IS, xf_part.shape[<span class="number">1</span>], endpoint=<span class="literal">False</span>)</span><br><span class="line">     t_aft = np.linspace(</span><br><span class="line">         <span class="number">0</span>, xf_part.shape[<span class="number">1</span>] / <span class="variable language_">self</span>.sfreq_IS,</span><br><span class="line">         <span class="built_in">int</span>(xf_part.shape[<span class="number">1</span>] / <span class="variable language_">self</span>.sfreq_IS * <span class="variable language_">self</span>.sfreq_OS), endpoint=<span class="literal">False</span></span><br><span class="line">     )</span><br><span class="line">     x_new = np.zeros((n_chan, t_aft.size))</span><br><span class="line">     <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(n_chan):</span><br><span class="line">         x_new[c] = np.interp(t_aft, t_bef, xf_part[c])</span><br><span class="line">     <span class="keyword">return</span> x_new</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>parameter’s meaning:</p>
<ol>
<li>offset_beg = np.searchsorted(self.parent.flags, self.nextFID, side=”left”): 下一個要處理的數據的起始索引。np.searchsorted 函數在 self.parent.flags 中查找 self.nextFID，並返回插入 self.nextFID 而不破壞排序的索引位置。side=”left” 表示在相等元素的左邊插入。</li>
<li>xLen: offset_beg 到 buffer 結束的數據長度，即還未處理的數據的長度。</li>
</ol>
</li>
<li><p>濾波：首先，將新的數據添加到x_part。然後，對每個通道的數據進行卷積操作，使用在 初始化時建立的濾波器FIR進行帶通濾波。<strong>最後，保留一部分數據以處理邊緣效應。</strong></p>
</li>
<li><p><del>降噪</del>(被註解掉了): 將每個通道的數據中減去平均值</p>
</li>
<li><p>Resample: 過插值實現將其從原始採樣率 self.sfreq_IS 轉換為輸出採樣率 self.sfreq_OS。</p>
</li>
</ul>
</li>
</ol>
<hr>
<!-- flag of hidden posts --></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://withoutdirection.github.io">烏鴉先生</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://withoutdirection.github.io/2025/02/13/test/">http://withoutdirection.github.io/2025/02/13/test/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%A8%8A%E8%99%9F%E8%99%95%E7%90%86/">訊號處理</a><a class="post-meta__tags" href="/tags/BCI/">BCI</a></div><div class="post-share"><div class="social-share" data-image="/img/crow.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/crow.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info-name">烏鴉先生</div><div class="author-info-description">隨手寫東西</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/WithoutDirection"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#EEG-Undergraduat-Research"><span class="toc-number">1.</span> <span class="toc-text">EEG_Undergraduat_Research</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0321-Stage-1"><span class="toc-number">1.1.</span> <span class="toc-text">0321: Stage 1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Outline"><span class="toc-number">1.1.1.</span> <span class="toc-text">Outline</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dataset"><span class="toc-number">1.1.2.</span> <span class="toc-text">Dataset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Model"><span class="toc-number">1.1.3.</span> <span class="toc-text">Model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Result"><span class="toc-number">1.1.4.</span> <span class="toc-text">Result</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0328-Preprocess"><span class="toc-number">1.2.</span> <span class="toc-text">0328: Preprocess</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#load-data"><span class="toc-number">1.2.1.</span> <span class="toc-text">load data</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#construct-object-for-data"><span class="toc-number">1.2.2.</span> <span class="toc-text">construct object for data</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#preprocess"><span class="toc-number">1.2.3.</span> <span class="toc-text">preprocess</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0404-Preprocess"><span class="toc-number">1.3.</span> <span class="toc-text">0404: Preprocess</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#preprocess-in-custom-py"><span class="toc-number">1.3.1.</span> <span class="toc-text">preprocess(in custom.py)</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/30/CSC-final/" title="電腦安全總整與實作期末筆記">電腦安全總整與實作期末筆記</a><time datetime="2025-05-29T16:00:00.000Z" title="Created 2025-05-30 00:00:00">2025-05-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/19/NA-midterm/" title="NA 期中大抄">NA 期中大抄</a><time datetime="2025-04-18T16:00:00.000Z" title="Created 2025-04-19 00:00:00">2025-04-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/13/CSC-midterm/" title="電腦安全總整與實作期中筆記">電腦安全總整與實作期中筆記</a><time datetime="2025-04-12T16:00:00.000Z" title="Created 2025-04-13 00:00:00">2025-04-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/16/Record-of-senior-in-NYCU/" title="交大資工-大四紀錄">交大資工-大四紀錄</a><time datetime="2025-03-15T16:09:58.726Z" title="Created 2025-03-16 00:09:58">2025-03-16</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent;"><div id="footer-wrap"><div class="copyright">©2019 - 2025 By 烏鴉先生</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>